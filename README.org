#+TITLE: Project structure test

Quite often, I'm sharing my =OCaml= work as standard shared objects (aka =.so= or
=.dll=). I recently manage to compile such a project with =dune=.

A ~shared_object~ linking mode was recently added to [[https://github.com/ocaml/dune][dune]]. I tried to take
advantage of it to simplify my =jbuild= files. Without success.

I'm creating the current project, in order to understand how to set things (and
get help on a concrete project).

Tests were performed with development version of =jbuilder=:
: $ jbuilder --version
: 1.0+beta19-33-g73231bf

* lib/

The =lib/= directory is there to provide a two functions pure =OCaml= lib: =mylib=.

#+NAME: mylib.mli
#+BEGIN_SRC ocaml
val add: int -> int -> int
val substract: int -> int -> int
#+END_SRC

This is the =OCaml= library to be shared to =C= users (I'll jump later to more
complex OCaml libraries that would have to be linked to third parties C lib).

* manual/

** dll/

   This directory builds =myclib.so= from:

   * =myclib.h=
   * =mylib_stub.c=: the =C= part of the shared library
   * =mylib_mlstub.ml=: the =OCaml= part of the library (registering functions
     from  =mylib=)

** TODO test/

   This directory contains a C test file.

   To test, just do ~make manualtest~:
   #+BEGIN_SRC bash
   $ make manualtest
   jbuilder build @runmanualtest
        montest alias manual/test/runmanualtest
   Avant init : 0
   Apr√®s init : 1
   Somme : 5 + 7 = 12
   Soustraction : 5 - 7 = -2
   #+END_SRC
